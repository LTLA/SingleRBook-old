<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Introduction | Assigning cell types with SingleR</title>
  <meta name="description" content="The SingleR book. Because sometimes, a vignette just isn’t enough." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Introduction | Assigning cell types with SingleR" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The SingleR book. Because sometimes, a vignette just isn’t enough." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Introduction | Assigning cell types with SingleR" />
  
  <meta name="twitter:description" content="The SingleR book. Because sometimes, a vignette just isn’t enough." />
  



<meta name="date" content="2020-05-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="using-the-built-in-references.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The SingleR book</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#motivation"><i class="fa fa-check"></i><b>1.1</b> Motivation</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#method-description"><i class="fa fa-check"></i><b>1.2</b> Method description</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#quick-start"><i class="fa fa-check"></i><b>1.3</b> Quick start</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#where-to-get-help"><i class="fa fa-check"></i><b>1.4</b> Where to get help</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#session-information"><i class="fa fa-check"></i>Session information</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#references"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="using-the-built-in-references.html"><a href="using-the-built-in-references.html"><i class="fa fa-check"></i><b>2</b> Using the built-in references</a><ul>
<li class="chapter" data-level="2.1" data-path="using-the-built-in-references.html"><a href="using-the-built-in-references.html#running-the-algorithm"><i class="fa fa-check"></i><b>2.1</b> Running the algorithm</a></li>
<li class="chapter" data-level="2.2" data-path="using-the-built-in-references.html"><a href="using-the-built-in-references.html#available-references"><i class="fa fa-check"></i><b>2.2</b> Available references</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="using-single-cell-references.html"><a href="using-single-cell-references.html"><i class="fa fa-check"></i><b>3</b> Using single-cell references</a><ul>
<li class="chapter" data-level="3.1" data-path="using-single-cell-references.html"><a href="using-single-cell-references.html#running-the-algorithm-1"><i class="fa fa-check"></i><b>3.1</b> Running the algorithm</a></li>
<li class="chapter" data-level="3.2" data-path="using-single-cell-references.html"><a href="using-single-cell-references.html#defining-custom-markers"><i class="fa fa-check"></i><b>3.2</b> Defining custom markers</a></li>
<li class="chapter" data-level="3.3" data-path="using-single-cell-references.html"><a href="using-single-cell-references.html#pseudo-bulk-aggregation"><i class="fa fa-check"></i><b>3.3</b> Pseudo-bulk aggregation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="annotation-diagnostics.html"><a href="annotation-diagnostics.html"><i class="fa fa-check"></i><b>4</b> Annotation diagnostics</a><ul>
<li class="chapter" data-level="4.1" data-path="annotation-diagnostics.html"><a href="annotation-diagnostics.html#based-on-the-scores-within-cells"><i class="fa fa-check"></i><b>4.1</b> Based on the scores within cells</a></li>
<li class="chapter" data-level="4.2" data-path="annotation-diagnostics.html"><a href="annotation-diagnostics.html#based-on-the-deltas-across-cells"><i class="fa fa-check"></i><b>4.2</b> Based on the deltas across cells</a></li>
<li class="chapter" data-level="4.3" data-path="annotation-diagnostics.html"><a href="annotation-diagnostics.html#based-on-marker-gene-expression"><i class="fa fa-check"></i><b>4.3</b> Based on marker gene expression</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="using-multiple-references.html"><a href="using-multiple-references.html"><i class="fa fa-check"></i><b>5</b> Using multiple references</a></li>
<li class="chapter" data-level="6" data-path="harmonizing-labels.html"><a href="harmonizing-labels.html"><i class="fa fa-check"></i><b>6</b> Harmonizing labels</a></li>
<li class="chapter" data-level="7" data-path="advanced-options.html"><a href="advanced-options.html"><i class="fa fa-check"></i><b>7</b> Advanced options</a><ul>
<li class="chapter" data-level="7.1" data-path="advanced-options.html"><a href="advanced-options.html#improving-efficiency"><i class="fa fa-check"></i><b>7.1</b> Improving efficiency</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bioconductor.org" target="blank">Published by Bioconductor</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Assigning cell types with SingleR</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="introduction" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Introduction</h1>
<div id="motivation" class="section level2">
<h2><span class="header-section-number">1.1</span> Motivation</h2>
<p>The Bioconductor package <em><a href="https://bioconductor.org/packages/3.12/SingleR">SingleR</a></em> implements an automatic annotation method for single-cell RNA sequencing (scRNA-seq) data <span class="citation">(Aran et al. <a href="#ref-aran2019reference">2019</a>)</span>. Given a reference dataset of samples (single-cell or bulk) with known labels, it assigns those labels to new cells from a test dataset based on similarities in their expression profiles. This provides a convenient way of transferring biological knowledge across datasets. allowing users to leverage the domain expertise implicit in the creation of each reference. The most common application of <em><a href="https://bioconductor.org/packages/3.12/SingleR">SingleR</a></em> involves predicting cell type (or “state”, or “kind”) in a new dataset, a process that is facilitated by the availability of built-in references and compatibility with user-supplied datasets. In this manner, the burden of manually interpreting clusters and defining marker genes only has to be done once, for the reference dataset, and this knowledge can be propagated to new datasets in an automated manner.</p>
</div>
<div id="method-description" class="section level2">
<h2><span class="header-section-number">1.2</span> Method description</h2>
<p><em><a href="https://bioconductor.org/packages/3.12/SingleR">SingleR</a></em> can be considered a robust variant of nearest-neighbors classification, with some tweaks to improve resolution for closely related labels. For each test cell:</p>
<ol style="list-style-type: decimal">
<li>We compute the Spearman correlation between its expression profile and that of each reference sample. The use of Spearman’s correlation provides a measure of robustness to batch effects across datasets. The calculation only uses the union of marker genes identified by pairwise comparisons between labels in the reference data, so as to improve resolution of separation between labels.</li>
<li>We define the per-label score as a fixed quantile (by default, 0.8) of the correlations across all samples with that label. This accounts for differences in the number of reference samples for each label, which interferes with simpler flavors of nearest neighbor classification; it also avoids penalizing classifications to heterogeneous labels by only requiring a good match to a minority of samples.</li>
<li>We repeat the score calculation for all labels in the reference dataset. The label with the highest score is used as <em><a href="https://bioconductor.org/packages/3.12/SingleR">SingleR</a></em>’s prediction for this cell.</li>
<li>We optionally perform a fine-tuning step to improve resolution between closely related labels. The reference dataset is subsetted to only include labels with scores close to the maximum, scores are recomputed using only marker genes for the subset of labels (thus focusing on the most relevant features), and this is iterated until one label remains.</li>
</ol>
</div>
<div id="quick-start" class="section level2">
<h2><span class="header-section-number">1.3</span> Quick start</h2>
<p>We will demonstrate the use of <code>SingleR()</code> on a classic 10X Genomics dataset <span class="citation">(Zheng et al. <a href="#ref-zheng2017massively">2017</a>)</span> with the built-in Human Primary Cell Atlas dataset <span class="citation">(Mabbott et al. <a href="#ref-hpcaRef">2013</a>)</span> as the reference.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Loading test data.</span>
<span class="kw">library</span>(TENxPBMCData)
new.data &lt;-<span class="st"> </span><span class="kw">TENxPBMCData</span>(<span class="st">&quot;pbmc4k&quot;</span>)

<span class="co"># Loading reference data with Ensembl annotations.</span>
<span class="kw">library</span>(SingleR)
ref.data &lt;-<span class="st"> </span><span class="kw">HumanPrimaryCellAtlasData</span>(<span class="dt">ensembl=</span><span class="ot">TRUE</span>)

<span class="co"># Performing predictions.</span>
predictions &lt;-<span class="st"> </span><span class="kw">SingleR</span>(<span class="dt">test=</span>new.data, <span class="dt">assay.type.test=</span><span class="dv">1</span>, 
    <span class="dt">ref=</span>ref.data, <span class="dt">labels=</span>ref.data<span class="op">$</span>label.main)

<span class="kw">table</span>(predictions<span class="op">$</span>labels)</code></pre></div>
<pre><code>## 
##           B_cell              CMP               DC              GMP 
##              606                8                1                2 
##         Monocyte          NK_cell        Platelets Pre-B_cell_CD34- 
##             1164              217                3               46 
##          T_cells 
##             2293</code></pre>
<p>And that’s it, really.</p>
</div>
<div id="where-to-get-help" class="section level2">
<h2><span class="header-section-number">1.4</span> Where to get help</h2>
<p>Questions on the general use of <em><a href="https://bioconductor.org/packages/3.12/SingleR">SingleR</a></em> should be posted to the <a href="https://support.bioconductor.org">Bioconductor support site</a>. Please send requests for general assistance and advice to the support site rather than to the individual authors. Bug reports or feature requests should be made to the <a href="https://github.com/LTLA/SingleR">GitHub repository</a>; well-considered suggestions for improvements are always welcome.</p>
</div>
<div id="session-information" class="section level2 unnumbered">
<h2>Session information</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()</code></pre></div>
<pre><code>## R version 4.0.0 Patched (2020-05-01 r78341)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 18.04.4 LTS
## 
## Matrix products: default
## BLAS:   /home/luna/Software/R/R-4-0-branch-dev/lib/libRblas.so
## LAPACK: /home/luna/Software/R/R-4-0-branch-dev/lib/libRlapack.so
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] parallel  stats4    stats     graphics  grDevices utils     datasets 
## [8] methods   base     
## 
## other attached packages:
##  [1] ensembldb_2.13.0            AnnotationFilter_1.13.0    
##  [3] GenomicFeatures_1.41.0      AnnotationDbi_1.51.0       
##  [5] SingleR_1.3.1               TENxPBMCData_1.7.0         
##  [7] HDF5Array_1.17.0            rhdf5_2.33.0               
##  [9] SingleCellExperiment_1.11.1 SummarizedExperiment_1.19.2
## [11] DelayedArray_0.15.1         matrixStats_0.56.0         
## [13] Biobase_2.49.0              GenomicRanges_1.41.1       
## [15] GenomeInfoDb_1.25.0         IRanges_2.23.4             
## [17] S4Vectors_0.27.4            BiocGenerics_0.35.1        
## [19] BiocStyle_2.17.0           
## 
## loaded via a namespace (and not attached):
##  [1] ProtGenerics_1.21.0           bitops_1.0-6                 
##  [3] bit64_0.9-7                   progress_1.2.2               
##  [5] httr_1.4.1                    tools_4.0.0                  
##  [7] R6_2.4.1                      irlba_2.3.3                  
##  [9] lazyeval_0.2.2                DBI_1.1.0                    
## [11] tidyselect_1.0.0              prettyunits_1.1.1            
## [13] bit_1.1-15.2                  curl_4.3                     
## [15] compiler_4.0.0                BiocNeighbors_1.7.0          
## [17] rtracklayer_1.49.1            bookdown_0.18                
## [19] askpass_1.1                   rappdirs_0.3.1               
## [21] stringr_1.4.0                 digest_0.6.25                
## [23] Rsamtools_2.5.0               rmarkdown_2.1                
## [25] XVector_0.29.0                pkgconfig_2.0.3              
## [27] htmltools_0.4.0               dbplyr_1.4.3                 
## [29] fastmap_1.0.1                 rlang_0.4.6                  
## [31] RSQLite_2.2.0                 shiny_1.4.0.2                
## [33] DelayedMatrixStats_1.11.0     BiocParallel_1.23.0          
## [35] dplyr_0.8.5                   RCurl_1.98-1.2               
## [37] magrittr_1.5                  BiocSingular_1.5.0           
## [39] GenomeInfoDbData_1.2.3        Matrix_1.2-18                
## [41] Rcpp_1.0.4.6                  Rhdf5lib_1.11.0              
## [43] lifecycle_0.2.0               stringi_1.4.6                
## [45] yaml_2.2.1                    zlibbioc_1.35.0              
## [47] BiocFileCache_1.13.0          AnnotationHub_2.21.0         
## [49] grid_4.0.0                    blob_1.2.1                   
## [51] promises_1.1.0                ExperimentHub_1.15.0         
## [53] crayon_1.3.4                  lattice_0.20-41              
## [55] beachmat_2.5.0                Biostrings_2.57.0            
## [57] hms_0.5.3                     knitr_1.28                   
## [59] pillar_1.4.4                  codetools_0.2-16             
## [61] biomaRt_2.45.0                XML_3.99-0.3                 
## [63] glue_1.4.0                    BiocVersion_3.12.0           
## [65] evaluate_0.14                 BiocManager_1.30.10          
## [67] vctrs_0.2.4                   httpuv_1.5.2                 
## [69] openssl_1.4.1                 purrr_0.3.4                  
## [71] assertthat_0.2.1              xfun_0.13                    
## [73] rsvd_1.0.3                    mime_0.9                     
## [75] xtable_1.8-4                  later_1.0.0                  
## [77] tibble_3.0.1                  GenomicAlignments_1.25.0     
## [79] memoise_1.1.0                 ellipsis_0.3.0               
## [81] interactiveDisplayBase_1.27.0</code></pre>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-aran2019reference">
<p>Aran, D., A. P. Looney, L. Liu, E. Wu, V. Fong, A. Hsu, S. Chak, et al. 2019. “Reference-based analysis of lung single-cell sequencing reveals a transitional profibrotic macrophage.” <em>Nat. Immunol.</em> 20 (2): 163–72.</p>
</div>
<div id="ref-hpcaRef">
<p>Mabbott, Neil A., J. K. Baillie, Helen Brown, Tom C. Freeman, and David A. Hume. 2013. “An expression atlas of human primary cells: Inference of gene function from coexpression networks.” <em>BMC Genomics</em> 14. doi:<a href="https://doi.org/10.1186/1471-2164-14-632">10.1186/1471-2164-14-632</a>.</p>
</div>
<div id="ref-zheng2017massively">
<p>Zheng, G. X., J. M. Terry, P. Belgrader, P. Ryvkin, Z. W. Bent, R. Wilson, S. B. Ziraldo, et al. 2017. “Massively parallel digital transcriptional profiling of single cells.” <em>Nat Commun</em> 8 (January): 14049.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="using-the-built-in-references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"bookdown::epub_book": "default",
"cover": "images/cover.png"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
