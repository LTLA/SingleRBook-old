<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Using multiple references | Assigning cell types with SingleR</title>
  <meta name="description" content="The SingleR book. Because sometimes, a vignette just isn't enough." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Using multiple references | Assigning cell types with SingleR" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The SingleR book. Because sometimes, a vignette just isn't enough." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Using multiple references | Assigning cell types with SingleR" />
  
  <meta name="twitter:description" content="The SingleR book. Because sometimes, a vignette just isn't enough." />
  



<meta name="date" content="2020-06-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="annotation-diagnostics.html"/>
<link rel="next" href="exploiting-the-cell-ontology.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The SingleR book</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>I Basic usage</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#motivation"><i class="fa fa-check"></i><b>1.1</b> Motivation</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#method-description"><i class="fa fa-check"></i><b>1.2</b> Method description</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#quick-start"><i class="fa fa-check"></i><b>1.3</b> Quick start</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#where-to-get-help"><i class="fa fa-check"></i><b>1.4</b> Where to get help</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#session-information"><i class="fa fa-check"></i>Session information</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="using-the-built-in-references.html"><a href="using-the-built-in-references.html"><i class="fa fa-check"></i><b>2</b> Using the built-in references</a><ul>
<li class="chapter" data-level="2.1" data-path="using-the-built-in-references.html"><a href="using-the-built-in-references.html#overview"><i class="fa fa-check"></i><b>2.1</b> Overview</a></li>
<li class="chapter" data-level="2.2" data-path="using-the-built-in-references.html"><a href="using-the-built-in-references.html#annotation-with-default-marker-detection"><i class="fa fa-check"></i><b>2.2</b> Annotation with default marker detection</a></li>
<li class="chapter" data-level="2.3" data-path="using-the-built-in-references.html"><a href="using-the-built-in-references.html#interaction-with-quality-control"><i class="fa fa-check"></i><b>2.3</b> Interaction with quality control</a></li>
<li class="chapter" data-level="2.4" data-path="using-the-built-in-references.html"><a href="using-the-built-in-references.html#choices-of-assay-data"><i class="fa fa-check"></i><b>2.4</b> Choices of assay data</a></li>
<li class="chapter" data-level="" data-path="using-the-built-in-references.html"><a href="using-the-built-in-references.html#session-information-1"><i class="fa fa-check"></i>Session information</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="using-single-cell-references.html"><a href="using-single-cell-references.html"><i class="fa fa-check"></i><b>3</b> Using single-cell references</a><ul>
<li class="chapter" data-level="3.1" data-path="using-single-cell-references.html"><a href="using-single-cell-references.html#overview-1"><i class="fa fa-check"></i><b>3.1</b> Overview</a></li>
<li class="chapter" data-level="3.2" data-path="using-single-cell-references.html"><a href="using-single-cell-references.html#annotation-with-test-based-marker-detection"><i class="fa fa-check"></i><b>3.2</b> Annotation with test-based marker detection</a></li>
<li class="chapter" data-level="3.3" data-path="using-single-cell-references.html"><a href="using-single-cell-references.html#defining-custom-markers"><i class="fa fa-check"></i><b>3.3</b> Defining custom markers</a></li>
<li class="chapter" data-level="3.4" data-path="using-single-cell-references.html"><a href="using-single-cell-references.html#pseudo-bulk-aggregation"><i class="fa fa-check"></i><b>3.4</b> Pseudo-bulk aggregation</a></li>
<li class="chapter" data-level="" data-path="using-single-cell-references.html"><a href="using-single-cell-references.html#session-information-2"><i class="fa fa-check"></i>Session information</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="annotation-diagnostics.html"><a href="annotation-diagnostics.html"><i class="fa fa-check"></i><b>4</b> Annotation diagnostics</a><ul>
<li class="chapter" data-level="4.1" data-path="annotation-diagnostics.html"><a href="annotation-diagnostics.html#overview-2"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="annotation-diagnostics.html"><a href="annotation-diagnostics.html#based-on-the-scores-within-cells"><i class="fa fa-check"></i><b>4.2</b> Based on the scores within cells</a></li>
<li class="chapter" data-level="4.3" data-path="annotation-diagnostics.html"><a href="annotation-diagnostics.html#based-on-the-deltas-across-cells"><i class="fa fa-check"></i><b>4.3</b> Based on the deltas across cells</a></li>
<li class="chapter" data-level="4.4" data-path="annotation-diagnostics.html"><a href="annotation-diagnostics.html#based-on-marker-gene-expression"><i class="fa fa-check"></i><b>4.4</b> Based on marker gene expression</a></li>
<li class="chapter" data-level="" data-path="annotation-diagnostics.html"><a href="annotation-diagnostics.html#session-information-3"><i class="fa fa-check"></i>Session information</a></li>
</ul></li>
<li class="part"><span><b>II Advanced usage</b></span></li>
<li class="chapter" data-level="5" data-path="using-multiple-references.html"><a href="using-multiple-references.html"><i class="fa fa-check"></i><b>5</b> Using multiple references</a><ul>
<li class="chapter" data-level="5.1" data-path="using-multiple-references.html"><a href="using-multiple-references.html#overview-3"><i class="fa fa-check"></i><b>5.1</b> Overview</a></li>
<li class="chapter" data-level="5.2" data-path="using-multiple-references.html"><a href="using-multiple-references.html#using-reference-specific-labels"><i class="fa fa-check"></i><b>5.2</b> Using reference-specific labels</a></li>
<li class="chapter" data-level="5.3" data-path="using-multiple-references.html"><a href="using-multiple-references.html#comparing-scores-across-references"><i class="fa fa-check"></i><b>5.3</b> Comparing scores across references</a><ul>
<li class="chapter" data-level="5.3.1" data-path="using-multiple-references.html"><a href="using-multiple-references.html#combining-inferences-from-individual-references"><i class="fa fa-check"></i><b>5.3.1</b> Combining inferences from individual references</a></li>
<li class="chapter" data-level="5.3.2" data-path="using-multiple-references.html"><a href="using-multiple-references.html#combined-diagnostics"><i class="fa fa-check"></i><b>5.3.2</b> Combined diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="using-multiple-references.html"><a href="using-multiple-references.html#using-harmonized-labels"><i class="fa fa-check"></i><b>5.4</b> Using harmonized labels</a><ul>
<li class="chapter" data-level="5.4.1" data-path="using-multiple-references.html"><a href="using-multiple-references.html#sharing-information-during-marker-detection"><i class="fa fa-check"></i><b>5.4.1</b> Sharing information during marker detection</a></li>
<li class="chapter" data-level="5.4.2" data-path="using-multiple-references.html"><a href="using-multiple-references.html#manual-label-harmonization"><i class="fa fa-check"></i><b>5.4.2</b> Manual label harmonization</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="using-multiple-references.html"><a href="using-multiple-references.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="exploiting-the-cell-ontology.html"><a href="exploiting-the-cell-ontology.html"><i class="fa fa-check"></i><b>6</b> Exploiting the cell ontology</a><ul>
<li class="chapter" data-level="6.1" data-path="exploiting-the-cell-ontology.html"><a href="exploiting-the-cell-ontology.html#motivation-1"><i class="fa fa-check"></i><b>6.1</b> Motivation</a></li>
<li class="chapter" data-level="6.2" data-path="exploiting-the-cell-ontology.html"><a href="exploiting-the-cell-ontology.html#basic-manipulation"><i class="fa fa-check"></i><b>6.2</b> Basic manipulation</a></li>
<li class="chapter" data-level="6.3" data-path="exploiting-the-cell-ontology.html"><a href="exploiting-the-cell-ontology.html#adjusting-resolution"><i class="fa fa-check"></i><b>6.3</b> Adjusting resolution</a></li>
<li class="chapter" data-level="" data-path="exploiting-the-cell-ontology.html"><a href="exploiting-the-cell-ontology.html#session-information-4"><i class="fa fa-check"></i>Session information</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="advanced-options.html"><a href="advanced-options.html"><i class="fa fa-check"></i><b>7</b> Advanced options</a><ul>
<li class="chapter" data-level="7.1" data-path="advanced-options.html"><a href="advanced-options.html#preconstructed-indices"><i class="fa fa-check"></i><b>7.1</b> Preconstructed indices</a></li>
<li class="chapter" data-level="7.2" data-path="advanced-options.html"><a href="advanced-options.html#parallelization"><i class="fa fa-check"></i><b>7.2</b> Parallelization</a></li>
<li class="chapter" data-level="7.3" data-path="advanced-options.html"><a href="advanced-options.html#approximate-algorithms"><i class="fa fa-check"></i><b>7.3</b> Approximate algorithms</a></li>
<li class="chapter" data-level="" data-path="advanced-options.html"><a href="advanced-options.html#session-information-5"><i class="fa fa-check"></i>Session information</a></li>
</ul></li>
<li class="part"><span><b>III Workflows</b></span></li>
<li class="chapter" data-level="8" data-path="cross-annotating-pancreas.html"><a href="cross-annotating-pancreas.html"><i class="fa fa-check"></i><b>8</b> Cross-annotating pancreas</a><ul>
<li class="chapter" data-level="8.1" data-path="cross-annotating-pancreas.html"><a href="cross-annotating-pancreas.html#loading-the-data"><i class="fa fa-check"></i><b>8.1</b> Loading the data</a></li>
<li class="chapter" data-level="8.2" data-path="cross-annotating-pancreas.html"><a href="cross-annotating-pancreas.html#applying-the-annotation"><i class="fa fa-check"></i><b>8.2</b> Applying the annotation</a></li>
<li class="chapter" data-level="8.3" data-path="cross-annotating-pancreas.html"><a href="cross-annotating-pancreas.html#diagnostics"><i class="fa fa-check"></i><b>8.3</b> Diagnostics</a></li>
<li class="chapter" data-level="" data-path="cross-annotating-pancreas.html"><a href="cross-annotating-pancreas.html#session-information-6"><i class="fa fa-check"></i>Session information</a></li>
</ul></li>
<li class="part"><span><b>IV Appendix</b></span></li>
<li class="chapter" data-level="9" data-path="contributors.html"><a href="contributors.html"><i class="fa fa-check"></i><b>9</b> Contributors</a><ul>
<li><a href="contributors.html#aaron-lun"><em>Aaron Lun</em></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="bibliography.html"><a href="bibliography.html"><i class="fa fa-check"></i><b>10</b> Bibliography</a></li>
<li class="divider"></li>
<li><a href="https://bioconductor.org" target="blank">Published by Bioconductor</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Assigning cell types with SingleR</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="using-multiple-references" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Using multiple references</h1>
<script>
document.addEventListener("click", function (event) {
    if (event.target.classList.contains("aaron-collapse")) {
        event.target.classList.toggle("active");
        var content = event.target.nextElementSibling;
        if (content.style.display === "block") {
            content.style.display = "none";
        } else {
            content.style.display = "block";
        }
    }
})
</script>
<style>
.aaron-collapse {
  background-color: #eee;
  color: #444;
  cursor: pointer;
  padding: 18px;
  width: 100%;
  border: none;
  text-align: left;
  outline: none;
  font-size: 15px;
}

.aaron-content {
  padding: 0 18px;
  display: none;
  overflow: hidden;
  background-color: #f1f1f1;
}
</style>
<div id="overview-3" class="section level2">
<h2><span class="header-section-number">5.1</span> Overview</h2>
<p>In some cases, we may wish to use multiple references for annotation of a test dataset. This yields a more comprehensive set of cell types that are not covered by any individual reference, especially when differences in the resolution are considered. However, it is not trivial due to the presence of batch effects across references (from differences in technology, experimental protocol or the biological system) as well as differences in the annotation vocabulary between investigators.</p>
<p>Several strategies are available to combine inferences from multiple references:</p>
<ul>
<li>using reference-specific labels in a combined reference</li>
<li>using harmonized labels in a combined reference</li>
<li>combining scores across multiple references</li>
</ul>
<p>This chapter discusses the various strengths and weaknesses of each strategy and provides some practical demonstrations of each. Here, we will use the HPCA and BlueprintEncode datasets as our references and (yet another) PBMC dataset as the test.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(TENxPBMCData)
pbmc &lt;-<span class="st"> </span><span class="kw">TENxPBMCData</span>(<span class="st">&quot;pbmc8k&quot;</span>)

<span class="kw">library</span>(SingleR)
hpca &lt;-<span class="st"> </span><span class="kw">HumanPrimaryCellAtlasData</span>(<span class="dt">ensembl=</span><span class="ot">TRUE</span>)
bpe &lt;-<span class="st"> </span><span class="kw">BlueprintEncodeData</span>(<span class="dt">ensembl=</span><span class="ot">TRUE</span>)</code></pre></div>
</div>
<div id="using-reference-specific-labels" class="section level2">
<h2><span class="header-section-number">5.2</span> Using reference-specific labels</h2>
<p>In this strategy, each label is defined in the context of its reference dataset. This means that a label - say, &quot;B cell&quot; - in reference dataset X is considered to be different from a &quot;B cell&quot; label in reference dataset Y. Use of reference-specific labels is most appropriate if there are relevant biological differences between the references; for example, if one reference is concerned with healthy tissue while the other reference considers diseased tissue, it can be helpful to distinguish between the same cell type in different biological contexts.</p>
<p>We can easily implement this approach by combining the expression matrices together and pasting the reference name onto the corresponding character vector of labels. This modification ensures that the downstream <code>SingleR()</code> call will treat each label-reference combination as a distinct entity.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hpca2 &lt;-<span class="st"> </span>hpca
hpca2<span class="op">$</span>label.main &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;HPCA.&quot;</span>, hpca2<span class="op">$</span>label.main)

bpe2 &lt;-<span class="st"> </span>bpe
bpe2<span class="op">$</span>label.main &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;BPE.&quot;</span>, bpe2<span class="op">$</span>label.main)

shared &lt;-<span class="st"> </span><span class="kw">intersect</span>(<span class="kw">rownames</span>(hpca2), <span class="kw">rownames</span>(bpe2))
combined &lt;-<span class="st"> </span><span class="kw">cbind</span>(hpca2[shared,], bpe2[shared,])</code></pre></div>
<p>It is then straightforward to perform annotation with the usual methods.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">com.res1 &lt;-<span class="st"> </span><span class="kw">SingleR</span>(pbmc, <span class="dt">ref=</span>combined, <span class="dt">labels=</span>combined<span class="op">$</span>label.main, <span class="dt">assay.type.test=</span><span class="dv">1</span>)
<span class="kw">table</span>(com.res1<span class="op">$</span>labels)</code></pre></div>
<pre><code>## 
##      BPE.B-cells BPE.CD4+ T-cells BPE.CD8+ T-cells          BPE.HSC 
##             1179             1708             2656               20 
##    BPE.Monocytes     BPE.NK cells  HPCA.HSC_-G-CSF   HPCA.Platelets 
##             2348              460                1                7 
##     HPCA.T_cells 
##                2</code></pre>
<p>However, this strategy identifies markers by directly comparing expression values across references, meaning that the marker set is likely to contain genes responsible for uninteresting batch effects. This will increase noise during the calculation of the score in each reference, possibly leading to a loss of precision and a greater risk of technical variation dominating the classification results. The use of reference-specific labels also complicates interpretation of the results as the cell type is always qualified by its reference of origin.</p>
</div>
<div id="comparing-scores-across-references" class="section level2">
<h2><span class="header-section-number">5.3</span> Comparing scores across references</h2>
<div id="combining-inferences-from-individual-references" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Combining inferences from individual references</h3>
<p>Another strategy - and the default approach implemented in <code>SingleR()</code> - involves performing classification separately within each reference, and then collating the results to choose the label with the highest score across references. This is a relatively expedient approach that avoids the need for explicit harmonization while also reducing exposure to reference-specific batch effects.</p>
<p>To use this method, we simply pass multiple objects to the <code>ref=</code> and <code>label=</code> argument in <code>SingleR()</code>. The combining strategy is as follows:</p>
<ol style="list-style-type: decimal">
<li>The function first annotates the test dataset with each reference individually in the same manner as described in Section <a href="introduction.html#method-description">1.2</a>. This step is almost equivalent to simply looping over all individual references and running <code>SingleR()</code> on each.</li>
<li>For each cell, the function collects its predicted labels across all references. In doing so, it also identifies the union of markers that are upregulated in the predicted label in each reference.</li>
<li>The function identifies the overall best-scoring label as the final prediction for that cell. This step involves a recomputation of the scores across the identified marker subset to ensure that these scores are derived from the same set of genes (and are thus comparable across references).</li>
</ol>
<p>The function will then return a <code>DataFrame</code> of combined results for each cell in the test dataset, including the overall label and the reference from which it was assigned.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">com.res2 &lt;-<span class="st"> </span><span class="kw">SingleR</span>(<span class="dt">test =</span> pbmc, <span class="dt">assay.type.test=</span><span class="dv">1</span>,
    <span class="dt">ref =</span> <span class="kw">list</span>(<span class="dt">BPE=</span>bpe, <span class="dt">HPCA=</span>hpca), 
    <span class="dt">labels =</span> <span class="kw">list</span>(bpe<span class="op">$</span>label.main, hpca<span class="op">$</span>label.main))

<span class="co"># Check the final label from the combined assignment.</span>
<span class="kw">table</span>(com.res2<span class="op">$</span>labels) </code></pre></div>
<pre><code>## 
##           B_cell          B-cells     CD4+ T-cells     CD8+ T-cells 
##               14             1170             1450             2936 
##              GMP              HSC         Monocyte        Monocytes 
##                1               22              753             1560 
##         NK cells          NK_cell        Platelets Pre-B_cell_CD34- 
##              372               10                9               16 
##          T_cells 
##               68</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Check the &#39;winning&#39; reference for each cell.</span>
<span class="kw">table</span>(com.res2<span class="op">$</span>reference) </code></pre></div>
<pre><code>## 
##    1    2 
## 7510  871</code></pre>
<p>The main appeal of this approach lies in the fact that it is based on the results of annotation with individual references. This avoids batch effects from comparing expression values across references; it reduces the need for any coordination in the label scheme between references; and simultaneously provides the per-reference annotations in the results. The last feature is particularly useful as it allows for more detailed diagnostics, troubleshooting and further analysis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(com.res2<span class="op">$</span>orig.results<span class="op">$</span>BPE<span class="op">$</span>labels)</code></pre></div>
<pre><code>## [1] &quot;B-cells&quot;      &quot;Monocytes&quot;    &quot;CD8+ T-cells&quot; &quot;CD8+ T-cells&quot; &quot;Monocytes&quot;   
## [6] &quot;Monocytes&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(com.res2<span class="op">$</span>orig.results<span class="op">$</span>HPCA<span class="op">$</span>labels)</code></pre></div>
<pre><code>## [1] &quot;B_cell&quot;   &quot;Monocyte&quot; &quot;T_cells&quot;  &quot;T_cells&quot;  &quot;Monocyte&quot; &quot;Monocyte&quot;</code></pre>
<p>The main downside is that it is somewhat suboptimal if there are many labels that are unique to one reference, as markers are not identified with the aim of distinguishing a label in one reference from another label in another reference. The continued lack of consistency in the labels across references also complicates interpretation of the results, though we can overcome this by using harmonized labels as described below.</p>
</div>
<div id="combined-diagnostics" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Combined diagnostics</h3>
<p>All of the diagnostic plots in <em><a href="https://bioconductor.org/packages/3.12/SingleR">SingleR</a></em> will naturally operate on these combined results. For example, we can create a heatmap of the scores in all of the individual references as well as for the recomputed scores in the combined results (Figure <a href="using-multiple-references.html#fig:heat-combined">5.1</a>). Note that scores are only recomputed for the labels predicted in the individual references, so all labels outside of those are simply set to <code>NA</code> - hence the swathes of grey.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plotScoreHeatmap</span>(com.res2)</code></pre></div>
<div class="figure"><span id="fig:heat-combined"></span>
<img src="multiple_files/figure-html/heat-combined-1.png" alt="Heatmaps of assignment scores for each cell in the PBMC test dataset after being assigned to the Blueprint/ENCODE and Human Primary Cell Atlas reference datasets. One heatmap is shown for the recomputed scores and the scores from each individual reference. The annotation at the top of each heatmap represents the final combined prediction for each cell." width="576" />
<p class="caption">
Figure 5.1: Heatmaps of assignment scores for each cell in the PBMC test dataset after being assigned to the Blueprint/ENCODE and Human Primary Cell Atlas reference datasets. One heatmap is shown for the recomputed scores and the scores from each individual reference. The annotation at the top of each heatmap represents the final combined prediction for each cell.
</p>
</div>
<p>The deltas for each individual reference can also be plotted with <code>plotDeltaDistribution()</code> (Figure <a href="using-multiple-references.html#fig:delta-combined">5.2</a>). No deltas are shown for the recomputed scores as the assumption described in Section <a href="annotation-diagnostics.html#based-on-the-deltas-across-cells">4.3</a> may not be applicable across the predicted labels from the individual references. For example, if all individual references suggest the same cell type with similar recomputed scores, any delta would be low even though the assignment is highly confident.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plotDeltaDistribution</span>(com.res2)</code></pre></div>
<div class="figure"><span id="fig:delta-combined"></span>
<img src="multiple_files/figure-html/delta-combined-1.png" alt="Distribution of the deltas across cells in the PBMC test dataset for each label in the Blueprint/ENCODE and Human Primary Cell Atlas reference datasets. Each point represents a cell that was assigned to that label in the combined results, colored by whether it was pruned or not in the corresponding individual reference." width="576" />
<p class="caption">
Figure 5.2: Distribution of the deltas across cells in the PBMC test dataset for each label in the Blueprint/ENCODE and Human Primary Cell Atlas reference datasets. Each point represents a cell that was assigned to that label in the combined results, colored by whether it was pruned or not in the corresponding individual reference.
</p>
</div>
<p>We can similarly extract marker genes to use in heatmaps as described in Section <a href="annotation-diagnostics.html#based-on-marker-gene-expression">4.4</a>. As annotation was performed to each individual reference, we can simply extract the marker genes from the nested <code>DataFrame</code>s as shown in Figure <a href="using-multiple-references.html#fig:pbmc-mono-heat">5.3</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hpca.markers &lt;-<span class="st"> </span><span class="kw">metadata</span>(com.res2<span class="op">$</span>orig.results<span class="op">$</span>HPCA)<span class="op">$</span>de.genes
bpe.markers &lt;-<span class="st"> </span><span class="kw">metadata</span>(com.res2<span class="op">$</span>orig.results<span class="op">$</span>BPE)<span class="op">$</span>de.genes
mono.markers &lt;-<span class="st"> </span><span class="kw">unique</span>(<span class="kw">unlist</span>(hpca.markers<span class="op">$</span>Monocyte, bpe.markers<span class="op">$</span>Monocytes))

<span class="kw">library</span>(scater)
<span class="kw">plotHeatmap</span>(<span class="kw">logNormCounts</span>(pbmc), 
    <span class="dt">order_columns_by=</span><span class="kw">list</span>(<span class="kw">I</span>(com.res2<span class="op">$</span>labels)),
    <span class="dt">features=</span>mono.markers)</code></pre></div>
<div class="figure"><span id="fig:pbmc-mono-heat"></span>
<img src="multiple_files/figure-html/pbmc-mono-heat-1.png" alt="Heatmap of log-expression values in the PBMC dataset for all marker genes upregulated in monocytes in the Blueprint/ENCODE and Human Primary Cell Atlas reference datasets. Combined labels for each cell are shown at the top." width="672" />
<p class="caption">
Figure 5.3: Heatmap of log-expression values in the PBMC dataset for all marker genes upregulated in monocytes in the Blueprint/ENCODE and Human Primary Cell Atlas reference datasets. Combined labels for each cell are shown at the top.
</p>
</div>
</div>
</div>
<div id="using-harmonized-labels" class="section level2">
<h2><span class="header-section-number">5.4</span> Using harmonized labels</h2>
<div id="sharing-information-during-marker-detection" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Sharing information during marker detection</h3>
<p>One of the major problems with using multiple references is the presence of study-specific nomenclature. For example, the concept of a B cell may be annotated as <code>B cells</code> in one reference, <code>B_cells</code> in another reference, and then <code>B</code> and <code>B-cell</code> and so on in other references. We can overcome this by using harmonized labels where the same cell type is assigned as the same label across references, simplifying interpretation and ensuring that irrelevant discrepancies in labelling do not intefere with downstream analysis.</p>
<p>Many of the <em><a href="https://bioconductor.org/packages/3.12/SingleR">SingleR</a></em> reference datasets already have their labels mapped to the <a href="https://www.ebi.ac.uk/ols/ontologies/cl">Cell Ontology</a>, which provides a standard vocabulary to refer to the same cell type across diverse datasets. We will describe the utility of Cell Ontology terms in more detail in Chapter <a href="exploiting-the-cell-ontology.html#exploiting-the-cell-ontology">6</a>; at this point, the key idea is that the same term is used for the same conceptual cell type in each reference. To simplify interpretation, we set <code>cell.ont=&quot;nonna&quot;</code> to remove all samples that could not be mapped to the ontology.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hpca.ont &lt;-<span class="st"> </span><span class="kw">HumanPrimaryCellAtlasData</span>(<span class="dt">ensembl=</span><span class="ot">TRUE</span>, <span class="dt">cell.ont=</span><span class="st">&quot;nonna&quot;</span>)
bpe.ont &lt;-<span class="st"> </span><span class="kw">BlueprintEncodeData</span>(<span class="dt">ensembl=</span><span class="ot">TRUE</span>, <span class="dt">cell.ont=</span><span class="st">&quot;nonna&quot;</span>)

<span class="co"># Using the same sets of genes:</span>
shared &lt;-<span class="st"> </span><span class="kw">intersect</span>(<span class="kw">rownames</span>(hpca.ont), <span class="kw">rownames</span>(bpe.ont))
hpca.ont &lt;-<span class="st"> </span>hpca.ont[shared,]
bpe.ont &lt;-<span class="st"> </span>bpe.ont[shared,]

<span class="co"># Showing the top 10 most frequent terms:</span>
<span class="kw">head</span>(<span class="kw">sort</span>(<span class="kw">table</span>(hpca.ont<span class="op">$</span>label.ont)), <span class="dv">10</span>)</code></pre></div>
<pre><code>## 
## CL:0002259 CL:0000017 CL:0000049 CL:0000050 CL:0000084 CL:0000127 CL:0000557 
##          1          2          2          2          2          2          2 
## CL:0000798 CL:0000816 CL:0000836 
##          2          2          2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">sort</span>(<span class="kw">table</span>(bpe.ont<span class="op">$</span>label.ont)), <span class="dv">10</span>)</code></pre></div>
<pre><code>## 
## CL:0000451 CL:0000771 CL:0000787 CL:0000815 CL:0000904 CL:0000905 CL:0000907 
##          1          1          1          1          1          1          1 
## CL:0000913 CL:0000972 CL:0000127 
##          1          1          2</code></pre>
<p>The simplest way to take advantage of the standardization in terminology is to use <code>label.ont</code> in place of <code>label.main</code> in the previous section's <code>SingleR()</code> call. This yields annotations that have follow the same vocabulary regardless of the reference used for assignment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">com.res3a &lt;-<span class="st"> </span><span class="kw">SingleR</span>(<span class="dt">test =</span> pbmc, <span class="dt">assay.type.test=</span><span class="dv">1</span>,
    <span class="dt">ref =</span> <span class="kw">list</span>(<span class="dt">BPE=</span>bpe.ont, <span class="dt">HPCA=</span>hpca.ont), 
    <span class="dt">labels =</span> <span class="kw">list</span>(bpe.ont<span class="op">$</span>label.ont, hpca.ont<span class="op">$</span>label.ont))

<span class="kw">table</span>(<span class="dt">Label=</span>com.res3a<span class="op">$</span>labels, <span class="dt">Reference=</span>com.res3a<span class="op">$</span>reference)</code></pre></div>
<pre><code>##             Reference
## Label           1    2
##   CL:0000037    2    0
##   CL:0000050    6    0
##   CL:0000051    6    0
##   CL:0000233    0    3
##   CL:0000236    0   70
##   CL:0000556    7    0
##   CL:0000557    4    1
##   CL:0000576 1520  548
##   CL:0000623  304   10
##   CL:0000624  734   34
##   CL:0000625  591   89
##   CL:0000786    2    0
##   CL:0000787  270    3
##   CL:0000788  728   12
##   CL:0000798    0    2
##   CL:0000815   78    0
##   CL:0000816    0   21
##   CL:0000837    5    0
##   CL:0000895    0  399
##   CL:0000904  126  867
##   CL:0000905  137  231
##   CL:0000907  729    0
##   CL:0000913  479    5
##   CL:0000955    0   13
##   CL:0000972  101    0
##   CL:0001054    0  244</code></pre>
<p>A more advanced approach is to share information across references during the marker detection stage. This is done by favoring genes the exhibit upregulation consistently in multiple references, which increases the likelihood that those markers will generalize to other datasets. For classic marker detection, we achieve this by calling <code>getClassicMarkers()</code> to obtain markers for use in <code>SingleR()</code>; the same effect can be achieved for test-based methods in <em><a href="https://bioconductor.org/packages/3.12/scran">scran</a></em> functions by setting <code>block=</code>. We then use these improved markers by passing them to <code>genes=</code> as described in Section <a href="using-single-cell-references.html#defining-custom-markers">3.3</a>. In this case, we specify <code>com.markers</code> twice in a list to indicate that we are using them for both of our references.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">com.markers &lt;-<span class="st"> </span><span class="kw">getClassicMarkers</span>(
    <span class="dt">ref =</span> <span class="kw">list</span>(<span class="dt">BPE=</span>bpe.ont, <span class="dt">HPCA=</span>hpca.ont), 
    <span class="dt">labels =</span> <span class="kw">list</span>(bpe.ont<span class="op">$</span>label.ont, hpca.ont<span class="op">$</span>label.ont))

com.res3b &lt;-<span class="st"> </span><span class="kw">SingleR</span>(<span class="dt">test =</span> pbmc, <span class="dt">assay.type.test=</span><span class="dv">1</span>,
    <span class="dt">ref =</span> <span class="kw">list</span>(<span class="dt">BPE=</span>bpe.ont, <span class="dt">HPCA=</span>hpca.ont), 
    <span class="dt">labels =</span> <span class="kw">list</span>(bpe.ont<span class="op">$</span>label.ont, hpca.ont<span class="op">$</span>label.ont),
    <span class="dt">genes =</span> <span class="kw">list</span>(com.markers, com.markers))

<span class="kw">table</span>(<span class="dt">Label=</span>com.res3b<span class="op">$</span>labels, <span class="dt">Reference=</span>com.res3b<span class="op">$</span>reference)</code></pre></div>
<pre><code>##             Reference
## Label           1    2
##   CL:0000037    4    0
##   CL:0000050    5    0
##   CL:0000051    8    0
##   CL:0000233    0    2
##   CL:0000236    0  106
##   CL:0000556    8    0
##   CL:0000557    1    2
##   CL:0000576 1435  669
##   CL:0000623  306   20
##   CL:0000624  605   90
##   CL:0000625  424  171
##   CL:0000786    3    0
##   CL:0000787  225    2
##   CL:0000788  719   30
##   CL:0000798    0    2
##   CL:0000815  111    0
##   CL:0000816    0   36
##   CL:0000837    5    0
##   CL:0000895    0  410
##   CL:0000904   55  986
##   CL:0000905  108  272
##   CL:0000907  728    0
##   CL:0000913  503   24
##   CL:0000955    0   10
##   CL:0000972   91    0
##   CL:0001054    0  205</code></pre>
<p>It is worth noting that, in the above code, the DE genes are still identified <em>within</em> each reference and then the statistics are merged <em>across</em> references to identify the top markers. This ensures that we do not directly compare expression values across references, which reduces the susceptibility of marker detection to batch effects.</p>
<p>The most obvious problem with this approach is that it assumes that harmonized labels are available. This is usually not true and requires some manual mapping of the author-provided labels to a common vocabulary. The mapping process also runs the risk of discarding relevant information about the biological status (e.g., activation status, disease condition) if there is no obvious counterpart for that state in the ontology.</p>
</div>
<div id="manual-label-harmonization" class="section level3">
<h3><span class="header-section-number">5.4.2</span> Manual label harmonization</h3>
<p>The <code>matchReferences()</code> function provides a simple approach for label harmonization between two references. Each reference is used to annotate the other and the probability of mutual assignment between each pair of labels is computed, i.e., for each pair of labels, what is the probability that a cell with one label is assigned the other <em>and</em> vice versa? Probabilities close to 1 in Figure <a href="using-multiple-references.html#fig:heat-harmony">5.4</a> indicate there is a 1:1 relation between that pair of labels; on the other hand, an all-zero probability vector indicates that a label is unique to a particular reference.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(SingleR)
bp.se &lt;-<span class="st"> </span><span class="kw">BlueprintEncodeData</span>()
hpca.se &lt;-<span class="st"> </span><span class="kw">HumanPrimaryCellAtlasData</span>()

matched &lt;-<span class="st"> </span><span class="kw">matchReferences</span>(bp.se, hpca.se,
    bp.se<span class="op">$</span>label.main, hpca.se<span class="op">$</span>label.main)
pheatmap<span class="op">::</span><span class="kw">pheatmap</span>(matched, <span class="dt">col=</span>viridis<span class="op">::</span><span class="kw">plasma</span>(<span class="dv">100</span>))</code></pre></div>
<div class="figure"><span id="fig:heat-harmony"></span>
<img src="multiple_files/figure-html/heat-harmony-1.png" alt="Heatmap of mutual assignment probabilities between the Blueprint/ENCODE reference dataset (labels in rows) and the Human primary cell atlas reference (labels in columns)." width="672" />
<p class="caption">
Figure 5.4: Heatmap of mutual assignment probabilities between the Blueprint/ENCODE reference dataset (labels in rows) and the Human primary cell atlas reference (labels in columns).
</p>
</div>
<p>This function can be used to guide harmonization to enforce a consistent vocabulary between two sets of labels. However, some manual intervention is still required in this process given the ambiguities posed by differences in biological systems and technologies. In the example above, neurons are considered to be unique to each reference while smooth muscle cells in the HPCA data are incorrectly matched to fibroblasts in the Blueprint/ENCODE data. CD4<sup>+</sup> and CD8<sup>+</sup> T cells are also both assigned to &quot;T cells&quot;, so some decision about the acceptable resolution of the harmonized labels is required here.</p>
<p>As an aside, we can also use this function to identify the matching clusters between two independent scRNA-seq analyses. This involves substituting the cluster assignments as proxies for the labels, allowing us to match up clusters and integrate conclusions from multiple datasets without the difficulties of batch correction and reclustering.</p>
</div>
</div>
<div id="session-info" class="section level2 unnumbered">
<h2>Session info</h2>
<button class="aaron-collapse">
View session info
</button>
<div class="aaron-content">
<pre><code>R version 4.0.0 Patched (2020-05-01 r78341)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 18.04.4 LTS

Matrix products: default
BLAS:   /home/luna/Software/R/R-4-0-branch-dev/lib/libRblas.so
LAPACK: /home/luna/Software/R/R-4-0-branch-dev/lib/libRlapack.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] parallel  stats4    stats     graphics  grDevices utils     datasets 
[8] methods   base     

other attached packages:
 [1] scater_1.17.3               ggplot2_3.3.1              
 [3] ensembldb_2.13.1            AnnotationFilter_1.13.0    
 [5] GenomicFeatures_1.41.0      AnnotationDbi_1.51.0       
 [7] SingleR_1.3.5               TENxPBMCData_1.7.0         
 [9] HDF5Array_1.17.0            rhdf5_2.33.3               
[11] SingleCellExperiment_1.11.4 SummarizedExperiment_1.19.5
[13] DelayedArray_0.15.1         matrixStats_0.56.0         
[15] Biobase_2.49.0              GenomicRanges_1.41.5       
[17] GenomeInfoDb_1.25.1         IRanges_2.23.9             
[19] S4Vectors_0.27.12           BiocGenerics_0.35.4        
[21] BiocStyle_2.17.0            rebook_0.99.0              

loaded via a namespace (and not attached):
  [1] ggbeeswarm_0.6.0              colorspace_1.4-1             
  [3] ellipsis_0.3.1                scuttle_0.99.9               
  [5] XVector_0.29.2                BiocNeighbors_1.7.0          
  [7] farver_2.0.3                  bit64_0.9-7                  
  [9] interactiveDisplayBase_1.27.5 codetools_0.2-16             
 [11] knitr_1.28                    Rsamtools_2.5.1              
 [13] dbplyr_1.4.4                  pheatmap_1.0.12              
 [15] graph_1.67.1                  shiny_1.4.0.2                
 [17] BiocManager_1.30.10           compiler_4.0.0               
 [19] httr_1.4.1                    assertthat_0.2.1             
 [21] Matrix_1.2-18                 fastmap_1.0.1                
 [23] lazyeval_0.2.2                later_1.1.0.1                
 [25] BiocSingular_1.5.0            htmltools_0.4.0              
 [27] prettyunits_1.1.1             tools_4.0.0                  
 [29] rsvd_1.0.3                    gtable_0.3.0                 
 [31] glue_1.4.1                    GenomeInfoDbData_1.2.3       
 [33] dplyr_1.0.0                   rappdirs_0.3.1               
 [35] Rcpp_1.0.4.6                  vctrs_0.3.1                  
 [37] Biostrings_2.57.2             rhdf5filters_1.1.0           
 [39] ExperimentHub_1.15.0          rtracklayer_1.49.3           
 [41] DelayedMatrixStats_1.11.0     xfun_0.14                    
 [43] stringr_1.4.0                 ps_1.3.3                     
 [45] beachmat_2.5.0                mime_0.9                     
 [47] lifecycle_0.2.0               irlba_2.3.3                  
 [49] XML_3.99-0.3                  AnnotationHub_2.21.0         
 [51] zlibbioc_1.35.0               scales_1.1.1                 
 [53] hms_0.5.3                     promises_1.1.1               
 [55] ProtGenerics_1.21.0           RColorBrewer_1.1-2           
 [57] yaml_2.2.1                    curl_4.3                     
 [59] gridExtra_2.3                 memoise_1.1.0                
 [61] biomaRt_2.45.0                stringi_1.4.6                
 [63] RSQLite_2.2.0                 highr_0.8                    
 [65] BiocVersion_3.12.0            BiocParallel_1.23.0          
 [67] rlang_0.4.6                   pkgconfig_2.0.3              
 [69] bitops_1.0-6                  evaluate_0.14                
 [71] lattice_0.20-41               purrr_0.3.4                  
 [73] Rhdf5lib_1.11.2               labeling_0.3                 
 [75] GenomicAlignments_1.25.3      CodeDepends_0.6.5            
 [77] bit_1.1-15.2                  processx_3.4.2               
 [79] tidyselect_1.1.0              magrittr_1.5                 
 [81] bookdown_0.19                 R6_2.4.1                     
 [83] generics_0.0.2                DBI_1.1.0                    
 [85] withr_2.2.0                   pillar_1.4.4                 
 [87] RCurl_1.98-1.2                tibble_3.0.1                 
 [89] crayon_1.3.4                  BiocFileCache_1.13.0         
 [91] rmarkdown_2.2                 viridis_0.5.1                
 [93] progress_1.2.2                grid_4.0.0                   
 [95] blob_1.2.1                    callr_3.4.3                  
 [97] digest_0.6.25                 xtable_1.8-4                 
 [99] httpuv_1.5.4                  openssl_1.4.1                
[101] munsell_0.5.0                 beeswarm_0.2.3               
[103] viridisLite_0.3.0             vipor_0.4.5                  
[105] askpass_1.1                  </code></pre>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="annotation-diagnostics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exploiting-the-cell-ontology.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"bookdown::epub_book": "default",
"cover": "images/cover.png"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
